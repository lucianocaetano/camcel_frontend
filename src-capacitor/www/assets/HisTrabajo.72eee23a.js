import{Q as x,f as i,g as m}from"./QItemLabel.bcb8e9f7.js";import{Q as z}from"./QList.7dfd456a.js";import{Q as M}from"./QBtnDropdown.6c97212f.js";import{r as u,l as U,a2 as r,aa as d,a6 as o,a4 as s,a5 as e,H as P,ab as c,a3 as v,ad as Q,ah as G,a9 as p,a7 as w,ac as D,ae as y,af as k}from"./index.c97da185.js";import{_ as J,Q as K,b as V}from"./QCardSection.3bdf9a7a.js";import{a as W,Q as S}from"./QPage.8210ad11.js";import{Q as X}from"./QCardActions.ba5cce65.js";import{Q as Y}from"./QDialog.d42c9718.js";import{C as R}from"./ClosePopup.e72f02d5.js";import{u as Z}from"./enterprise.store.bd76e559.js";import{b as ee}from"./axios.3d912423.js";import{u as ae}from"./user.store.7bf26499.js";import"./pinia.485b638e.js";const oe={class:"ola q-mx-auto"},le={key:0},te={class:"col-6",style:{width:"60%"}},re={class:"text-h6"},se={class:"text-subtitle1"},ne={class:"col-6"},ie={__name:"HisTrabajo",props:["items"],setup(ce){ae().token,Z();const g=u([]);u([]),u(!1),u(""),u(""),u(0);const I=u({});u(null);const h=u("Todos"),C=u([]),T=t=>{h.value=t,N()},N=()=>{const t=new Date().toISOString().split("T")[0];g.value=C.value.filter(a=>{const l=a.fechas;return l.length>0&&l[l.length-1]<t}),h.value==="Aceptados"?g.value=g.value.filter(a=>a.confirmacionPREV===1&&a.confirmacionEmpresa===1):h.value==="Rechazados"&&(g.value=g.value.filter(a=>a.confirmacionPREV===0||a.confirmacionEmpresa===0))};u({nombre:"",trabajo:"",fechaInicio:"",fechaFin:"",horaEntrada:"",horaSalida:"",confirmacionEmpresa:!1,confirmacionPREV:null});const B=t=>{I.value[t]=!$(t)},$=t=>!!I.value[t],_=u(),E=u(!1);function F(t){E.value=!0,_.value=t}function A(t){return t===null?"No disponible":t===1?"S\xED":"No"}function H(){E.value=!1}function L(t){window.open(t.url,"_blank")}async function O(){try{const t=await ee.get("admin/jobs"),a=t.data.jobs,l=t.data.job_dates;C.value=[],a.forEach(n=>{const f=l.filter(b=>b.job_id===n.id)||[];if(!Array.isArray(f)){console.error("La variable 'fechas' no es un array:",f);return}const j=f.map(b=>new Date(b.fecha.replace(/"/g,""))).sort((b,q)=>b-q).map(b=>b.toISOString().split("T")[0]);C.value.push({id:n.id,nombre:n.enterprise,trabajo:n.trabajo||"Trabajo desconocido",fechas:j,confirmacionPREV:n.confirmacion_prevencionista,confirmacionEmpresa:n.confirmacion_empresa})}),C.value.sort((n,f)=>n.id-f.id),N()}catch(t){console.error("Error al obtener item:",t)}}return U(O),(t,a)=>(r(),d(W,null,{default:o(()=>[s("div",oe,[e(M,{color:"#ffffff",label:h.value,"text-color":"#000000",style:{"margin-bottom":"2%"}},{default:o(()=>[e(z,null,{default:o(()=>[P((r(),d(x,{clickable:"",onClick:a[0]||(a[0]=l=>T("Todos"))},{default:o(()=>[e(i,null,{default:o(()=>[e(m,null,{default:o(()=>a[4]||(a[4]=[c("Todos")])),_:1})]),_:1})]),_:1})),[[R]]),P((r(),d(x,{clickable:"",onClick:a[1]||(a[1]=l=>T("Aceptados"))},{default:o(()=>[e(i,null,{default:o(()=>[e(m,null,{default:o(()=>a[5]||(a[5]=[c("Aceptados")])),_:1})]),_:1})]),_:1})),[[R]]),P((r(),d(x,{clickable:"",onClick:a[2]||(a[2]=l=>T("Rechazados"))},{default:o(()=>[e(i,null,{default:o(()=>[e(m,null,{default:o(()=>a[6]||(a[6]=[c("Rechazados")])),_:1})]),_:1})]),_:1})),[[R]])]),_:1})]),_:1},8,["label"]),e(z,{bordered:"",style:{"background-color":"#ffffff"}},{default:o(()=>[e(x,{bordered:""},{default:o(()=>[e(i,{class:"col-2"},{default:o(()=>[e(m,{header:""},{default:o(()=>a[7]||(a[7]=[c("Nombre Empresa")])),_:1})]),_:1}),e(i,{class:"col-2"},{default:o(()=>[e(m,{header:""},{default:o(()=>a[8]||(a[8]=[c("Trabajo a realizar")])),_:1})]),_:1}),e(i,{class:"col-2 text-center"},{default:o(()=>[e(m,{header:""},{default:o(()=>a[9]||(a[9]=[c("Fechas de Trabajo")])),_:1})]),_:1}),e(i,{class:"col-2 text-center"},{default:o(()=>[e(m,{header:""},{default:o(()=>a[10]||(a[10]=[c("Confirmaci\xF3n "),s("br",null,null,-1),c("Prevencionista")])),_:1})]),_:1}),e(i,{class:"col-2 text-center"},{default:o(()=>[e(m,{header:""},{default:o(()=>a[11]||(a[11]=[c("Confirmaci\xF3n "),s("br",null,null,-1),c("Empresa")])),_:1})]),_:1}),e(i,{class:"col-2 text-center"},{default:o(()=>[e(m,{header:""},{default:o(()=>a[12]||(a[12]=[c("M\xE1s informaci\xF3n")])),_:1})]),_:1})]),_:1}),e(z,{bordered:""}),(r(!0),v(D,null,Q(g.value,(l,n)=>(r(),d(x,{key:n,class:G({"bg-grey-4":n%2===0})},{default:o(()=>[e(i,{class:"col-2"},{default:o(()=>[c(p(l.nombre),1)]),_:2},1024),e(i,{class:"col-2"},{default:o(()=>[c(p(l.trabajo),1)]),_:2},1024),e(i,{class:"col-2 text-center"},{default:o(()=>[s("div",null,[e(w,{onClick:f=>B(n),label:`${l.fechas[0]} - ${l.fechas[l.fechas.length-1]}`},null,8,["onClick","label"])]),$(n)?(r(),v("div",le,[(r(!0),v(D,null,Q(l.fechas,(f,j)=>(r(),v("div",{key:j},p(f),1))),128))])):y("",!0)]),_:2},1024),e(i,{class:"col-3 text-center"},{default:o(()=>[s("div",null,[l.confirmacionPREV===null?(r(),d(k,{key:0,name:"mdi-close-circle",color:"red",size:"40px",style:{"padding-right":"20px"}})):y("",!0),l.confirmacionPREV===1?(r(),d(k,{key:1,name:"mdi-check-circle",color:"green",size:"40px",style:{"padding-right":"20px"}})):y("",!0),l.confirmacionPREV===0?(r(),d(k,{key:2,name:"mdi-close-circle",color:"red",size:"40px",style:{"padding-right":"20px"}})):y("",!0)])]),_:2},1024),e(i,{class:"col-1 text-center"},{default:o(()=>[l.confirmacionEmpresa?(r(),d(k,{key:0,name:"mdi-check-circle",color:"green",size:"40px"})):y("",!0),l.confirmacionEmpresa?y("",!0):(r(),d(k,{key:1,name:"mdi-close-circle",color:"red",size:"40px"}))]),_:2},1024),e(i,{class:"col-2 text-center"},{default:o(()=>[s("div",null,[e(w,{class:"q-mx-auto",style:{"background-color":"white"},onClick:()=>F(l)},{default:o(()=>[e(k,{name:"description",size:"30px"})]),_:2},1032,["onClick"])])]),_:2},1024)]),_:2},1032,["class"]))),128))]),_:1})]),e(Y,{modelValue:E.value,"onUpdate:modelValue":a[3]||(a[3]=l=>E.value=l),persistent:""},{default:o(()=>[e(K,{style:{"min-width":"90%","min-height":"90%",display:"flex"}},{default:o(()=>[s("div",te,[e(V,{class:"col-6"},{default:o(()=>[s("div",re,"Empresa: "+p(_.value.nombre),1),s("div",se,"Trabajo a realizar: "+p(_.value.trabajo),1)]),_:1}),e(S),e(V,null,{default:o(()=>[a[13]||(a[13]=s("div",{class:"text-body1"},[s("strong",null,"Fechas:")],-1)),(r(!0),v(D,null,Q(_.value.fechas,(l,n)=>(r(),v("div",{key:n},p(l),1))),128))]),_:1}),e(S),e(V,null,{default:o(()=>[a[14]||(a[14]=s("div",{class:"text-body1"},[s("strong",null,"Confirmaci\xF3n:")],-1)),s("p",null,"Prevencionista: "+p(A(_.value.confirmacionPREV)),1),s("p",null,"Empresa: "+p(A(_.value.confirmacionEmpresa)),1)]),_:1}),e(S)]),s("div",ne,[e(V,{class:"col-12",style:{width:"40%",height:"90%"}},{default:o(()=>[a[15]||(a[15]=s("div",{class:"text-body1"},[s("strong",null,"Documentos:")],-1)),(r(!0),v(D,null,Q(_.value.Documentos,(l,n)=>(r(),v("div",{key:n},[e(w,{flat:"",color:"primary",onClick:f=>L(l)},{default:o(()=>[c(p(l.titulo),1)]),_:2},1032,["onClick"])]))),128))]),_:1}),e(S)]),e(X,{style:{"align-items":"right","align-content":"flex-end"}},{default:o(()=>[e(w,{flat:"",label:"Cerrar",color:"primary",onClick:H})]),_:1})]),_:1})]),_:1},8,["modelValue"])]),_:1}))}};var Ee=J(ie,[["__scopeId","data-v-05c2a634"]]);export{Ee as default};
