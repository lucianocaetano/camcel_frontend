import{aF as j,a as N,r as _,a2 as r,aa as w,a6 as s,a5 as a,a4 as o,aG as T,a3 as u,ad as b,a9 as C,ac as v,a7 as V,H as g,ai as G,ae as E,ab as M}from"./index.c97da185.js";import{Q as y}from"./QInput.9d3d625c.js";import{f as Q,g as D,Q as A}from"./QItemLabel.bcb8e9f7.js";import{Q as J}from"./QList.7dfd456a.js";import{Q as K}from"./QBtnDropdown.6c97212f.js";import{Q as W}from"./QMarkupTable.915e59d6.js";import{C as k}from"./ClosePopup.e72f02d5.js";import{b as B}from"./axios.3d912423.js";import{V as X}from"./ValidDeleteMenu.6c00e83b.js";import{_ as L,b as H,Q as F}from"./QCardSection.3bdf9a7a.js";import{Q as I}from"./QSelect.2b0028e2.js";import{Q as R}from"./QForm.2ebf8009.js";import{Q as P}from"./QCardActions.ba5cce65.js";import{Q as z}from"./QDialog.d42c9718.js";import"./user.store.7bf26499.js";import"./pinia.485b638e.js";import"./QChip.ba98e3ca.js";import"./format.a8cdc0f5.js";const Y={props:{show:{type:Boolean,required:!0},user:{type:Object,required:!0}},setup(p,{emit:l}){const U=[{label:"Empresario",value:"Enterprise"},{label:"Guardia",value:"Guard"},{label:"Admin",value:"Admin"}],e=j(p,"show"),m=N({name:p.user.name,email:p.user.email,password:void 0,rol:p.user.rol==="Empresario sin empresa"?U[0]:p.user.rol}),h=_(null),i=()=>{l("handleCloseEditUser")};return{handleEditUser:()=>{B.patch("users/"+p.user.id,{...m,rol:m.rol.value,email:m.email===p.user.email?void 0:m.email},{headers:{"Content-Type":"application/json"}}).then(()=>{i()}).catch(d=>{var n;if(console.error(d),((n=d==null?void 0:d.response)==null?void 0:n.status)===422){const t=d.response.data.errors;h.value=t}})},show:e,handleCloseEditUser:i,roles:U,data:m,error_create:h}}},Z={class:"q-pa-xs bg-negative text-white"},$={class:"q-pa-xs bg-negative text-white"},ee={class:"q-pa-xs bg-negative text-white"},le={class:"q-pa-xs bg-negative text-white"};function ae(p,l,U,e,m,h){return r(),w(z,{modelValue:e.show,"onUpdate:modelValue":l[4]||(l[4]=i=>e.show=i)},{default:s(()=>[a(F,{style:{width:"900px"}},{default:s(()=>[a(H,null,{default:s(()=>l[5]||(l[5]=[o("div",{class:"text-h6"},"Editar Usuario",-1)])),_:1}),a(H,{class:"q-pt-none"},{default:s(()=>[a(R,{onSubmit:T(e.handleEditUser,["prevent"])},{default:s(()=>{var i,f,d,n;return[a(y,{name:"name",label:"name",modelValue:e.data.name,"onUpdate:modelValue":l[0]||(l[0]=t=>e.data.name=t)},null,8,["modelValue"]),(r(!0),u(v,null,b((i=e.error_create)==null?void 0:i.name,(t,c)=>(r(),u("div",{key:c,class:"q-mt-sm"},[o("span",Z,C(t),1)]))),128)),a(y,{name:"email",type:"email",label:"email",modelValue:e.data.email,"onUpdate:modelValue":l[1]||(l[1]=t=>e.data.email=t)},null,8,["modelValue"]),(r(!0),u(v,null,b((f=e.error_create)==null?void 0:f.email,(t,c)=>(r(),u("div",{key:c,class:"q-mt-sm"},[o("span",$,C(t),1)]))),128)),a(y,{name:"password",type:"password",label:"password",modelValue:e.data.password,"onUpdate:modelValue":l[2]||(l[2]=t=>e.data.password=t),value:""},null,8,["modelValue"]),(r(!0),u(v,null,b((d=e.error_create)==null?void 0:d.password,(t,c)=>(r(),u("div",{key:c,class:"q-mt-sm"},[o("span",ee,C(t),1)]))),128)),a(I,{modelValue:e.data.rol,"onUpdate:modelValue":l[3]||(l[3]=t=>e.data.rol=t),options:e.roles,label:"Rol Usuario"},null,8,["modelValue","options"]),(r(!0),u(v,null,b((n=e.error_create)==null?void 0:n.rol,(t,c)=>(r(),u("div",{key:c,class:"q-mt-sm"},[o("span",le,C(t),1)]))),128)),a(V,{label:"Edit",class:"q-mt-md",type:"submit",color:"primary"})]}),_:1},8,["onSubmit"])]),_:1}),a(P,{align:"right"},{default:s(()=>[g(a(V,{flat:"",label:"Cerrar",color:"primary",onClick:e.handleCloseEditUser},null,8,["onClick"]),[[k]])]),_:1})]),_:1})]),_:1},8,["modelValue"])}var te=L(Y,[["render",ae]]);const se={props:{show:{type:Boolean,required:!0}},setup(p,{emit:l}){const U=[{label:"Empresario",value:"Enterprise"},{label:"Guardia",value:"Guard"},{label:"Admin",value:"Admin"}],e=j(p,"show"),m=N({email:"",name:"",password:"",rol:U[0]}),h=_(null),i=()=>{l("handleCreateUserMenuClose")};return{data:m,handleCreateUser:()=>{B.post("users",{...m,rol:m.rol.value},{headers:{"Content-Type":"application/json"}}).then(()=>{i()}).catch(d=>{var n;if(console.error(d),((n=d==null?void 0:d.response)==null?void 0:n.status)===422){const t=d.response.data.errors;h.value=t}})},show:e,handleCloseCreateUser:i,roles:U,error_create:h}}},re={class:"q-pa-xs bg-negative text-white"},ne={class:"q-pa-xs bg-negative text-white"},oe={class:"q-pa-xs bg-negative text-white"},de={class:"q-pa-xs bg-negative text-white"};function ie(p,l,U,e,m,h){return r(),w(z,{modelValue:e.show,"onUpdate:modelValue":l[4]||(l[4]=i=>e.show=i)},{default:s(()=>[a(F,{style:{width:"900px"}},{default:s(()=>[a(H,null,{default:s(()=>l[5]||(l[5]=[o("div",{class:"text-h6"},"Crear Usuarios",-1)])),_:1}),a(H,{class:"q-pt-none"},{default:s(()=>[a(R,{onSubmit:T(e.handleCreateUser,["prevent"])},{default:s(()=>{var i,f,d,n;return[a(y,{name:"name",required:"",label:"name",modelValue:e.data.name,"onUpdate:modelValue":l[0]||(l[0]=t=>e.data.name=t)},null,8,["modelValue"]),(r(!0),u(v,null,b((i=e.error_create)==null?void 0:i.name,(t,c)=>(r(),u("div",{key:c,class:"q-mt-sm"},[o("span",re,C(t),1)]))),128)),a(y,{name:"email",required:"",type:"email",label:"email",modelValue:e.data.email,"onUpdate:modelValue":l[1]||(l[1]=t=>e.data.email=t)},null,8,["modelValue"]),(r(!0),u(v,null,b((f=e.error_create)==null?void 0:f.email,(t,c)=>(r(),u("div",{key:c,class:"q-mt-sm"},[o("span",ne,C(t),1)]))),128)),a(y,{name:"password",required:"",type:"password",label:"password",modelValue:e.data.password,"onUpdate:modelValue":l[2]||(l[2]=t=>e.data.password=t)},null,8,["modelValue"]),(r(!0),u(v,null,b((d=e.error_create)==null?void 0:d.password,(t,c)=>(r(),u("div",{key:c,class:"q-mt-sm"},[o("span",oe,C(t),1)]))),128)),a(I,{modelValue:e.data.rol,"onUpdate:modelValue":l[3]||(l[3]=t=>e.data.rol=t),required:"","option-label":"label","option-value":"value",options:e.roles,label:"Rol Usuario"},null,8,["modelValue","options"]),(r(!0),u(v,null,b((n=e.error_create)==null?void 0:n.rol,(t,c)=>(r(),u("div",{key:c,class:"q-mt-sm"},[o("span",de,C(t),1)]))),128)),a(V,{label:"Crear",class:"q-mt-md",type:"submit",color:"primary"})]}),_:1},8,["onSubmit"])]),_:1}),a(P,{align:"right"},{default:s(()=>[g(a(V,{flat:"",label:"Cerrar",color:"primary",onClick:e.handleCloseCreateUser},null,8,["onClick"]),[[k]])]),_:1})]),_:1})]),_:1},8,["modelValue"])}var ue=L(se,[["render",ie]]);const me={components:{ValidDeleteUserMenu:X,CreateUser:ue,EditUser:te},setup(){const p=_(!0),l=_([]),U=_(null),e=_(""),m=_(!1),h=_(!1),i=_(!1),f=_(null),d=x=>{B.delete(`users/${x}}`).then(O=>{O.status===200&&(l.value=l.value.filter(S=>S.id!==x))})},n=x=>{f.value=x,m.value=!0},t=()=>{m.value=!1},c=()=>{m.value=!1,d(f.value),f.value=null,q()},q=(x=void 0)=>{const O={role:x};B.get("users",{params:O}).then(S=>{p.value=!1,l.value=S.data.users})};return q(),{fetchUsers:q,users:l,isLoading:p,handleDeleteUser:d,validDeleteMenu:m,handleDeleteUserMenuClose:t,handleDeleteUserMenuOpen:n,handleDeleteUserMenuAccept:c,handleEditUserMenuClose:()=>{q(),i.value=!1},handleEditUserMenuOpen:x=>{U.value=x,i.value=!0},editUser:i,handleCreateUserMenuClose:()=>{q(),h.value=!1},handleCreateUserMenuOpen:()=>{h.value=!0},createUser:h,user:U,search:e}}},ce={class:"flex justify-center"},pe={class:"full-width flex justify-center"},fe={class:"q-pa-md"},he={class:"text-left"},Ue={class:"text-right"},Ce={class:"text-right"},ve={class:"text-right"};function _e(p,l,U,e,m,h){const i=G("ValidDeleteUserMenu"),f=G("EditUser"),d=G("CreateUser");return r(),u(v,null,[e.validDeleteMenu?(r(),w(i,{key:0,show:e.validDeleteMenu,onHandleDeleteMenuClose:e.handleDeleteUserMenuClose,onHandleDeleteMenuAccept:e.handleDeleteUserMenuAccept},null,8,["show","onHandleDeleteMenuClose","onHandleDeleteMenuAccept"])):E("",!0),e.editUser?(r(),w(f,{key:1,show:e.editUser,onHandleCloseEditUser:e.handleEditUserMenuClose,user:e.user},null,8,["show","onHandleCloseEditUser","user"])):E("",!0),e.createUser?(r(),w(d,{key:2,show:e.createUser,onHandleCreateUserMenuClose:e.handleCreateUserMenuClose},null,8,["show","onHandleCreateUserMenuClose"])):E("",!0),o("div",ce,[a(y,{style:{"max-width":"700px",width:"100%"},filled:"",modelValue:e.search,"onUpdate:modelValue":l[0]||(l[0]=n=>e.search=n),class:"custom-input q-mb-md",label:"Busqueda"},{prepend:s(()=>[a(V,{flat:"",round:"",dense:"",class:"icono_de_busqueda",icon:"search"})]),_:1},8,["modelValue"])]),o("div",pe,[o("div",null,[a(V,{class:"bg-primary text-white q-mr-md",onClick:e.handleCreateUserMenuOpen},{default:s(()=>l[5]||(l[5]=[M("Crear")])),_:1},8,["onClick"]),a(K,{color:"#000000",label:"Filtrar","text-color":"#000000"},{default:s(()=>[a(J,null,{default:s(()=>[g((r(),w(A,{clickable:"",onClick:l[1]||(l[1]=n=>e.fetchUsers(void 0))},{default:s(()=>[a(Q,null,{default:s(()=>[a(D,null,{default:s(()=>l[6]||(l[6]=[M("Todos")])),_:1})]),_:1})]),_:1})),[[k]]),g((r(),w(A,{clickable:"",onClick:l[2]||(l[2]=n=>e.fetchUsers("Admin"))},{default:s(()=>[a(Q,null,{default:s(()=>[a(D,null,{default:s(()=>l[7]||(l[7]=[M("Admins")])),_:1})]),_:1})]),_:1})),[[k]]),g((r(),w(A,{clickable:"",onClick:l[3]||(l[3]=n=>e.fetchUsers("Enterprise"))},{default:s(()=>[a(Q,null,{default:s(()=>[a(D,null,{default:s(()=>l[8]||(l[8]=[M("Empresarios")])),_:1})]),_:1})]),_:1})),[[k]]),g((r(),w(A,{clickable:"",onClick:l[4]||(l[4]=n=>e.fetchUsers("Guard"))},{default:s(()=>[a(Q,null,{default:s(()=>[a(D,null,{default:s(()=>l[9]||(l[9]=[M("Guardias")])),_:1})]),_:1})]),_:1})),[[k]])]),_:1})]),_:1})])]),o("div",fe,[a(W,{style:{height:"500px","overflow-y":"scroll"}},{default:s(()=>[l[10]||(l[10]=o("thead",null,[o("tr",null,[o("th",{class:"text-left"},"Name"),o("th",{class:"text-right"},"Email"),o("th",{class:"text-right"},"Rol"),o("th",{class:"text-right"},"Actions")])],-1)),o("tbody",null,[(r(!0),u(v,null,b(e.users,n=>(r(),u("tr",{key:n.id,class:"cursor-pointer"},[n.name.toLowerCase().includes(e.search.toLowerCase())?(r(),u(v,{key:0},[o("td",he,C(n.name),1),o("td",Ue,C(n.email),1),o("td",Ce,C(n.rol),1),o("td",ve,[a(V,{icon:"edit",class:"text-primary q-mr-md",onClick:()=>e.handleEditUserMenuOpen(n)},null,8,["onClick"]),a(V,{icon:"delete",class:"text-negative",onClick:()=>e.handleDeleteUserMenuOpen(n.id)},null,8,["onClick"])])],64)):E("",!0)]))),128))])]),_:1})])],64)}var Fe=L(me,[["render",_e]]);export{Fe as default};
